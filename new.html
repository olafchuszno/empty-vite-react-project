<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="SMART Web Chat Assistant" />
    <title>SMART Web Chat</title>
    <script src="https://cdn.botframework.com/botframework-webchat/latest/webchat.js"></script>
    <script>
      let webChatInstance = null;
      let directLineUrl = null;

      // Replace with your token endpoint
      const tokenEndpoint =
        'https://default2f6c8737ed214ad1985442f3fa8717.ca.environment.api.powerplatform.com/powervirtualagents/botsbyschema/cr75d_agentstWmdG/directline/token?api-version=2022-03-01-preview';
      const styleOptions = {
        accent: '#0078D4',
        autoScrollSnapOnPage: true,
        autoScrollSnapOnPageOffset: 0,
        avatarBorderRadius: '7%',
        avatarSize: 31,
        backgroundColor: '#e8e9eb',
        botAvatarBackgroundColor: '#ffffff00',
        botAvatarImage:
          'https://powercatexternal.blob.core.windows.net/creatorkit/Assets/ChatbotLogoBlue.png',
        botAvatarInitials: 'B',
        bubbleAttachmentMaxWidth: 480,
        bubbleAttachmentMinWidth: 250,
        bubbleBackground: '#f0eded',
        bubbleBorderColor: '#f5f5f5',
        bubbleBorderRadius: 41,
        bubbleBorderStyle: 'solid',
        bubbleBorderWidth: 1,
        bubbleFromUserBackground: '#ebefff',
        bubbleFromUserBorderColor: '#f5f5f5',
        bubbleFromUserBorderRadius: 41,
        bubbleFromUserBorderStyle: 'solid',
        bubbleFromUserBorderWidth: 1,
        bubbleFromUserNubOffset: 0,
        bubbleFromUserNubSize: 0,
        bubbleFromUserTextColor: '#242424',
        bubbleImageHeight: 10,
        bubbleImageMaxHeight: 240,
        bubbleImageMinHeight: 240,
        bubbleMessageMaxWidth: 480,
        bubbleMessageMinWidth: 120,
        bubbleMinHeight: 50,
        bubbleNubOffset: 0,
        bubbleTextColor: '#242424',
        emojiSet: true,
        fontSizeSmall: '70%',
        hideUploadButton: false,
        messageActivityWordBreak: 'break-word',
        monospaceFont: 'Consolas',
        paddingRegular: 10,
        paddingWide: 10,
        primaryFont: null,
        sendBoxBackground: '#e8e9eb',
        sendBoxBorderTop: 'solid 1px #808080',
        sendBoxButtonColor: '#0078d4',
        sendBoxButtonColorOnHover: '#006cbe',
        sendBoxButtonShadeBorderRadius: 40,
        sendBoxButtonShadeColorOnHover: '',
        sendBoxHeight: 60,
        sendBoxPlaceholderColor: '#171616',
        sendBoxTextColor: '#2e2d2d',
        showAvatarInGroup: 'status',
        spinnerAnimationHeight: 16,
        spinnerAnimationPadding: 12,
        spinnerAnimationWidth: 16,
        subtleColor: '#000000FF',
        suggestedActionBackgroundColor: '#006FC4FF',
        suggestedActionBackgroundColorOnHover: '#0078D4',
        suggestedActionBorderColor: '',
        suggestedActionBorderRadius: 10,
        suggestedActionBorderWidth: 1,
        suggestedActionLayout: 'flow',
        suggestedActionTextColor: '#FFFFFFFF',
        typingAnimationBackgroundImage:
          "url('https://wpamelia.com/wp-content/uploads/2018/11/ezgif-2-6d0b072c3d3f.gif')",
        typingAnimationDuration: 5000,
        typingAnimationHeight: 20,
        typingAnimationWidth: 64,
        userAvatarBackgroundColor: '#222222',
        userAvatarImage:
          'https://avatars.githubusercontent.com/u/8174072?v=4&size=64',
        userAvatarInitials: 'U',
      };
      const backgroundImage = '';
      document.addEventListener('DOMContentLoaded', () => {
        const root = document.documentElement;
        root.style.setProperty(
          '--primary-color',
          createGradient(styleOptions.accent)
        );
        root.style.setProperty(
          '--header-textColor',
          styleOptions.suggestedActionTextColor
        );
        if (backgroundImage) {
          const webchatElement = document.getElementById('webchat');
          webchatElement.style.backgroundImage = `url(${backgroundImage})`;
          webchatElement.style.backgroundSize = 'cover';
          webchatElement.style.backgroundPosition = 'center';
          webchatElement.style.backgroundRepeat = 'no-repeat';
          const overlay = document.createElement('div');
          overlay.className = 'webchat-overlay';
          webchatElement.appendChild(overlay);
        }
      });
      function createGradient(baseColor) {
        const r = parseInt(baseColor.slice(1, 3), 16);
        const g = parseInt(baseColor.slice(3, 5), 16);
        const b = parseInt(baseColor.slice(5, 7), 16);
        const lighterColor = `#${Math.min(255, r + 30)
          .toString(16)
          .padStart(2, '0')}${Math.min(255, g + 30)
          .toString(16)
          .padStart(2, '0')}${Math.min(255, b + 30)
          .toString(16)
          .padStart(2, '0')}`;
        const darkerColor = `#${Math.max(0, r - 30)
          .toString(16)
          .padStart(2, '0')}${Math.max(0, g - 30)
          .toString(16)
          .padStart(2, '0')}${Math.max(0, b - 30)
          .toString(16)
          .padStart(2, '0')}`;
        return `linear-gradient(135deg, ${lighterColor}, ${baseColor}, ${darkerColor})`;
      }
      const environmentEndPoint = tokenEndpoint.slice(
        0,
        tokenEndpoint.indexOf('/powervirtualagents')
      );
      const apiVersion = tokenEndpoint
        .slice(tokenEndpoint.indexOf('api-version'))
        .split('=')[1];
      const regionalChannelSettingsURL = `${environmentEndPoint}/powervirtualagents/regionalchannelsettings?api-version=${apiVersion}`;
      function showChat() {
        const popup = document.getElementById('chatbot-popup');
        const openButton = document.getElementById('open-chat');
        popup.classList.add('visible');
        openButton.classList.add('hidden');

        setTimeout(() => {
          document.querySelector('.webchat__upload-button')?.remove();
        });
      }
      function hideChat() {
        const popup = document.getElementById('chatbot-popup');
        const openButton = document.getElementById('open-chat');
        popup.classList.remove('visible');
        openButton.classList.remove('hidden');
      }
      function createCustomStore() {
        return window.WebChat.createStore(
          {},
          ({ dispatch }) =>
            (next) =>
            (action) => {
              if (action.type === 'DIRECT_LINE/CONNECT_FULFILLED') {
                dispatch({
                  type: 'DIRECT_LINE/POST_ACTIVITY',
                  meta: { method: 'keyboard' },
                  payload: {
                    activity: {
                      channelData: { postBack: true },
                      name: 'startConversation',
                      type: 'event',
                    },
                  },
                });
              }
              return next(action);
            }
        );
      }
      async function restartConversation() {
        try {
          if (!directLineUrl) {
            console.error('DirectLine URL not initialized');
            return;
          }
          const response = await fetch(tokenEndpoint);
          const conversationInfo = await response.json();
          if (!conversationInfo.token) {
            throw new Error('Failed to get conversation token');
          }
          const newDirectLine = window.WebChat.createDirectLine({
            domain: `${directLineUrl}v3/directline`,
            token: conversationInfo.token,
          });
          const webchatElement = document.getElementById('webchat');
          webChatInstance = window.WebChat.renderWebChat(
            {
              directLine: newDirectLine,
              styleOptions,
              store: createCustomStore(),
            },
            webchatElement
          );
        } catch (err) {
          console.error('Failed to restart conversation:', err);
        }
      }
      async function initializeChat() {
        try {
          const response = await fetch(regionalChannelSettingsURL);
          const data = await response.json();
          directLineUrl = data.channelUrlsById.directline;
          if (!directLineUrl) {
            throw new Error('Failed to get DirectLine URL');
          }
          const conversationResponse = await fetch(tokenEndpoint);
          const conversationInfo = await conversationResponse.json();
          if (!conversationInfo.token) {
            throw new Error('Failed to get conversation token');
          }
          const directLine = window.WebChat.createDirectLine({
            domain: `${directLineUrl}v3/directline`,
            token: conversationInfo.token,
          });
          webChatInstance = window.WebChat.renderWebChat(
            {
              directLine,
              styleOptions,
              store: createCustomStore(),
            },
            document.getElementById('webchat')
          );
        } catch (err) {
          console.error('Failed to initialize chat:', err);
        }
      }
      initializeChat();
    </script>
    <style>
      :root {
        --primary-gradient: var(--primary-color);
        --chat-width: 450px;
        --chat-height: 520px;
        --header-height: 56px;
        --border-radius: 16px;
        --transition-speed: 0.3s;
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI',
          Roboto, sans-serif;
      }
      body {
        min-height: 100vh;
        background-color: #f3f4f6;
      }
      #chatbot-popup {
        display: none;
        position: fixed;
        bottom: 32px;
        right: 32px;
        width: var(--chat-width);
        height: var(--chat-height);
        background: white;
        border-radius: var(--border-radius);
        box-shadow: 0 18px 40px -5px rgba(0, 0, 0, 0.2),
          0 15px 20px -5px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        opacity: 0;
        transform-origin: bottom right;
        transform: scale(0.95);
        transition: all var(--transition-speed) ease-in-out;
        z-index: 999;
      }
      .webchat__send-box-text-box {
        padding-left: 18px !important;
      }
      #chatbot-popup.visible {
        display: block;
        opacity: 1;
        transform: scale(1);
      }
      #chatbot-header {
        background: var(--primary-color);
        padding: 16px 20px;
        height: var(--header-height);
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: var(--header-textColor);
      }
      .header-title {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 16px;
        font-weight: 500;
      }
      .header-buttons {
        display: flex;
        gap: 12px;
        align-items: center;
      }
      .icon-button {
        background: none;
        border: none;
        color: var(--header-textColor);
        cursor: pointer;
        padding: 8px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }
      .icon-button:hover {
        color: var(--header-textColor);
        background: rgba(0, 0, 0, 0.2);
      }
      .icon-button:focus {
        outline: 2px solid rgba(0, 0, 0, 0.4);
        outline-offset: 2px;
      }
      #webchat {
        height: calc(100% - var(--header-height));
        background-color: #f9fafb;
        position: relative;
      }
      .webchat-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.85);
        pointer-events: none;
        z-index: 1;
      }
      #webchat > div {
        position: relative;
        z-index: 2;
      }
      #webchat .webchat__basic-transcript__content {
        white-space: pre-wrap !important;
        word-break: break-word !important;
      }
      #webchat .webchat__bubble__content {
        padding: 8px 12px !important;
      }
      #webchat .webchat__bubble {
        max-width: 85% !important;
        margin: 8px !important;
      }
      #webchat .webchat__basic-transcript__content ul,
      #webchat .webchat__basic-transcript__content ol,
      #webchat .webchat__bubble__content ul,
      #webchat .webchat__bubble__content ol {
        padding-left: 24px !important;
        margin: 8px 0 !important;
        list-style-position: outside !important;
      }
      #webchat .webchat__basic-transcript__content li,
      #webchat .webchat__bubble__content li {
        margin: 4px 0 !important;
        padding-left: 4px !important;
      }
      #open-chat {
        position: fixed;
        bottom: 32px;
        right: 32px;
        width: 64px;
        height: 64px;
        border-radius: 50%;
        background: var(--primary-gradient);
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        transition: all var(--transition-speed) ease-in-out;
        z-index: 998;
      }
      #open-chat.hidden {
        opacity: 0;
        transform: scale(0.95) translateY(10px);
        pointer-events: none;
      }
      #open-chat:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      }
      #open-chat:focus {
        outline: 3px solid rgba(79, 70, 229, 0.5);
        outline-offset: 2px;
      }
      #open-chat svg {
        width: 28px;
        height: 28px;
        color: white;
        transition: transform 0.2s ease;
      }
      .main-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 48px 24px;
      }
      .main-content h1 {
        font-size: 36px;
        color: #111827;
        text-align: center;
      }
      .main-content p {
        font-size: 18px;
        color: #4b5563;
        line-height: 1.6;
        margin-bottom: 48px;
        text-align: center;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
      }
      .content-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 32px;
        margin-bottom: 32px;
      }
      .content-box {
        background: linear-gradient(135deg, #e6e6e6, #c4c4c4, #9f9f9f);
        padding: 32px;
        border-radius: 12px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        min-height: 300px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        position: relative;
        overflow: hidden;
      }
      .content-box::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
      }
      .content-box.featured {
        grid-column: span 2;
        min-height: 350px;
        background: linear-gradient(135deg, #e6e6e6, #c4c4c4, #9f9f9f);
        color: #000000;
      }
      .content-box h2 {
        font-size: 24px;
        margin-bottom: 16px;
        position: relative;
      }
      .content-box p {
        font-size: 16px;
        color: #6b7280;
        margin-bottom: 0;
      }
      .content-box.featured p {
        color: #000000;
      }
      @media (max-width: 768px) {
        .content-grid {
          grid-template-columns: 1fr;
        }
        .content-box.featured {
          grid-column: span 1;
        }
        .main-content {
          padding: 24px 16px;
        }
        .main-content h1 {
          font-size: 28px;
        }
        #chatbot-popup {
          width: 100%;
          height: 100%;
          bottom: 0;
          right: 0;
          border-radius: 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="main-content">
      <h1>Header</h1>
      <p>
        Lorem ipsum dolor sit amet consectetur adipiscing elit. Quisque faucibus
        ex sapien vitae pellentesque sem placerat.
      </p>
      <div class="content-grid">
        <div class="content-box featured">
          <h2>Featured Content</h2>
          <p>
            Primary content area with custom styling and gradient background
          </p>
        </div>
        <div class="content-box">
          <h2>Section One</h2>
          <p>Content box with minimal design</p>
        </div>
        <div class="content-box">
          <h2>Section Two</h2>
          <p>Another content section with consistent styling</p>
        </div>
      </div>
    </div>
    <div id="chatbot-popup" role="complementary" aria-label="Chat Assistant">
      <header
        style="
          background-color: #f3f4f6;
          border-bottom: 1px solid #e5e7eb;
          display: flex;
          height: 60px;
          align-items: center;
          justify-content: space-between;
          padding: 0 16px;
          padding-top: 20px;
          padding-bottom: 20px;
        "
      >
        <h1
          style="
            font-size: 18px;
            font-weight: 500;
            line-height: 20px;
            letter-spacing: -1px;
            margin: 0;
          "
        >
          SMART AI Assistant
        </h1>
        <span style="display: flex; align-items: center; gap: 16px">
          <div style="display: flex; align-items: center; gap: 4px">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              height="24"
              fill="none"
              width="24"
            >
              <path
                d="M8.35755 4C10.7038 6.36149 12.823 9.45976 13.8258 12.2558V12.2747C11.366 15.2029 6.06807 11.7079 8.35755 4Z"
                fill="url(#paint0_radial_80_7105)"
                fill-rule="evenodd"
                clip-rule="evenodd"
                opacity="0.9"
              ></path>
              <path
                d="M14.9043 13.1061C14.5448 12.6716 14.242 12.1048 14.242 11.198C14.242 9.98893 14.8286 9.00655 15.8314 8.94987H15.8125C15.6044 8.94987 14.9989 9.10101 14.5259 9.3655C13.9015 9.70555 13.3338 10.2345 12.804 10.8957C10.9687 13.1628 9.64418 16.9412 8.86841 19.3593C9.20899 19.1515 11.0444 18.9437 12.804 18.2069C15.207 17.1679 16.9099 15.5998 14.9043 13.1061Z"
                fill="url(#paint1_radial_80_7105)"
                fill-rule="evenodd"
                clip-rule="evenodd"
              ></path>
              <path
                d="M18.2534 9.76233C17.6857 9.76233 17.3073 9.3845 16.7964 9.15779C16.5126 9.02555 16.2477 8.96887 15.9828 8.94998C15.9261 8.94998 15.8693 8.94998 15.7936 8.94998C15.7936 8.94998 15.7936 8.94998 15.8125 8.94998C14.8097 9.00666 14.2231 9.98904 14.2231 11.1981C14.2231 12.1049 14.5259 12.6717 14.8854 13.1062C15.8693 14.3342 15.9639 15.3354 15.5098 16.1667C16.1153 15.3166 16.0774 13.9186 16.0396 12.8606C16.0017 11.4815 16.2477 10.2913 19.8806 9.93236C20.5807 9.85679 21.3186 9.81901 21.9998 9.76233C22.0187 9.76233 18.2534 9.76233 18.2534 9.76233Z"
                fill="url(#paint2_radial_80_7105)"
                fill-rule="evenodd"
                clip-rule="evenodd"
              ></path>
              <path
                d="M2 6.22914C5.97347 7.36266 10.1361 9.42187 12.9176 11.8589V11.8778C12.0472 16.5252 4.17595 15.9585 2 6.22914Z"
                fill="url(#paint3_radial_80_7105)"
                fill-rule="evenodd"
                clip-rule="evenodd"
                opacity="0.9"
              ></path>
              <defs>
                <radialGradient
                  gradientTransform="translate(13.2113 12.6337) scale(10.1976 10.1818)"
                  gradientUnits="userSpaceOnUse"
                  id="paint0_radial_80_7105"
                  cx="0"
                  cy="0"
                  r="1"
                >
                  <stop stop-color="#E2E428"></stop>
                  <stop stop-color="#C6D92F" offset="0.3"></stop>
                  <stop stop-color="#7DC570" offset="0.54"></stop>
                  <stop stop-color="#00B3A0" offset="0.7"></stop>
                  <stop stop-color="#00B6BA" offset="0.85"></stop>
                  <stop stop-color="#1CBECA" offset="1"></stop>
                </radialGradient>
                <radialGradient
                  gradientTransform="translate(12.9507 8.93359) scale(10.0939 10.0782)"
                  gradientUnits="userSpaceOnUse"
                  id="paint1_radial_80_7105"
                  cx="0"
                  cy="0"
                  r="1"
                >
                  <stop stop-color="#F2EE7D" offset="2.1e-07"></stop>
                  <stop stop-color="#EFEA58" offset="0.0916247"></stop>
                  <stop stop-color="#E2E428" offset="0.2006"></stop>
                  <stop stop-color="#C8DA2D" offset="0.3009"></stop>
                  <stop stop-color="#B0D235" offset="0.3909"></stop>
                  <stop stop-color="#97C73B" offset="0.4677"></stop>
                  <stop stop-color="#7EBD3F" offset="0.5756"></stop>
                  <stop stop-color="#5A9C3A" offset="0.6906"></stop>
                  <stop stop-color="#358135" offset="0.8735"></stop>
                </radialGradient>
                <radialGradient
                  gradientTransform="translate(17.8907 12.9098) scale(4.23903 4.23245)"
                  gradientUnits="userSpaceOnUse"
                  id="paint2_radial_80_7105"
                  cx="0"
                  cy="0"
                  r="1"
                >
                  <stop stop-color="#358135" offset="0.3521"></stop>
                  <stop stop-color="#5D9D3A" offset="0.4662"></stop>
                  <stop stop-color="#7EBD3F" offset="0.5883"></stop>
                  <stop stop-color="#97C73B" offset="0.7062"></stop>
                  <stop stop-color="#B0D235" offset="0.7593"></stop>
                  <stop stop-color="#C8DA2D" offset="0.8149"></stop>
                  <stop stop-color="#E2E428" offset="0.9085"></stop>
                  <stop stop-color="#EFEA58" offset="1"></stop>
                </radialGradient>
                <radialGradient
                  gradientTransform="translate(12.8164 12.6109) scale(12.5633 12.5438)"
                  gradientUnits="userSpaceOnUse"
                  id="paint3_radial_80_7105"
                  cx="0"
                  cy="0"
                  r="1"
                >
                  <stop stop-color="#E2E428"></stop>
                  <stop stop-color="#C6D92F" offset="0.3"></stop>
                  <stop stop-color="#7DC570" offset="0.54"></stop>
                  <stop stop-color="#00B3A0" offset="0.7"></stop>
                  <stop stop-color="#00B6BA" offset="0.85"></stop>
                  <stop stop-color="#1CBECA" offset="1"></stop>
                </radialGradient>
              </defs>
            </svg>
            <span
              style="
                display: flex;
                flex-direction: column;
                font-size: 11px;
                font-weight: 400;
                line-height: 10px;
              "
            >
              <span>Powered by</span>
              <span>SMART business</span>
            </span>
          </div>
        </span>
        <div class="header-buttons">
          <button
            class="icon-button"
            id="restart-button"
            onclick="restartConversation()"
            aria-label="Restart Conversation"
          >
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="black"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              aria-hidden="true"
            >
              <path
                d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"
              ></path>
              <path d="M3 3v5h5"></path>
            </svg>
          </button>
          <button
            class="icon-button"
            id="close-button"
            onclick="hideChat()"
            aria-label="Close Chat"
          >
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="black"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              aria-hidden="true"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
      </header>
      <div id="webchat" role="main"></div>
    </div>
    <button
      id="open-chat"
      onclick="showChat()"
      aria-label="Open Chat Assistant"
    >
      <svg
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        aria-hidden="true"
      >
        <path
          d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"
        ></path>
      </svg>
    </button>
  </body>
</html>
